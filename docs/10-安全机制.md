# 安全机制

## 多层限流防护

### 邮件发送限流

```python
def check_email_rate_limit(email: str) -> tuple[bool, str]:
    # 层1：每分钟最多1次
    if not check_rate_limit(f"email_1min:{email}", 1, 1):
        return False, "发送过于频繁，请1分钟后再试"
    # 层2：每小时最多3次
    if not check_rate_limit(f"email_1h:{email}", 3, 60):
        return False, "发送次数过多，请1小时后再试"
    # 层3：每天最多10次
    if not check_rate_limit(f"email_1d:{email}", 10, 1440):
        return False, "今日发送次数已达上限，请明天再试"
    # 层4：全局每天最多200封
    if not check_rate_limit("email_global_1d", 200, 1440):
        return False, "系统邮件发送量已达今日上限"
    return True, ""
```

## 验证码安全

- **有效期**：5分钟
- **尝试次数**：3次
- **单邮箱限制**：同时只能有1个有效验证码

## 密码安全

```python
def hash_password(password: str) -> str:
    return hashlib.sha256(password.encode('utf-8')).hexdigest()
```

- 使用 SHA256 单向加密
- 不存储明文密码
- 管理员强制只能用验证码登录
